var config=["$stateProvider","$httpProvider","$urlRouterProvider","$authProvider","$locationProvider","envServiceProvider","ezfbProvider",function(i,e,s,t,r,l,o){i.state("news",{url:"/",controller:"newsIndexCtrl",templateUrl:"views/news/news.list.html"}).state("newsDetail",{url:"/{id:[a-zA-Z1-9.-]*}",controller:"newsDetailCtrl",templateUrl:"views/news/news.detail.html"}),l.config({domains:{development:["localhost","kisikisi.dev","berita.kisikisi.dev"],production:["103.11.74.10","kisikisi.id","berita.kisikisi.id"]},vars:{development:{site:"//kisikisi.dev/",api:"//api.kisikisi.dev/",file:"//files.kisikisi.dev/",news:"//berita.kisikisi.dev/"},production:{site:"//kisikisi.id/",api:"//api.kisikisi.id/",news:"//berita.kisikisi.id/",file:"//files.kisikisi.id/"}}}),l.check(),r.html5Mode(!0),s.otherwise("/"),t.loginUrl="/login",o.setInitParams({appId:"135688693164869"})}];
var newsDetailCtrl=["$http","$scope","$location","$sce","$stateParams","Notification",function(t,a,e,i,s,d){t.get(a.env.api+"news/"+s.id).success(function(t){a.detail=t.detail,a.detail.description=i.trustAsHtml(t.detail.description),a.detail.data=i.trustAsHtml(t.detail.data),a.detail.map_address=i.trustAsResourceUrl(t.detail.map_address),a.onDetail=!0})}];
var newsIndexCtrl=["$http","$scope","$rootScope","$location","Notification","envService",function(o,t,e,n,c,i){}];
var newsCtrl=["$http","$scope","$rootScope","$sce","$auth","$location","Notification","envService",function(e,t,n,a,s,o,i,r){n.env=r.read("all"),t.news=[],t.scrollBusy=!1,t.limit=6,t.after=0,t.onSearch=!1,t.filter={},t.letterLimit=200,t.popup=function(){$(".browse").popup({inline:!0,hoverable:!0,delay:{show:300,hide:800}})},t.$on("$includeContentLoaded",function(e){t.modal1=$("#siteModal").modal(),t.modal2=$("#basicModal").modal()}),t.indexSearch=function(e,t){return e.map(function(e){return e.id}).indexOf(t)},t.toggleSearch=function(){0==t.onSearch?t.onSearch=!0:t.onSearch=!1},t.filterNews=function(){e.get(t.env.api+"news/form").success(function(e){t.newsCategories=e.newsCategories,t.labels=e.labels})},t.filterNews(),t.searchNews=function(e){t.after=0,t.news=[],t.nextPage(),t.filter=e,t.onSearch=!1},t.nextPage=function(){t.scrollBusy=!0,e.get(t.env.api+"news/scroll/"+t.after+"/"+t.limit,{params:t.filter}).success(function(e){for(var n=0;n<e.news.length;n++)t.news.push(e.news[n]);for(var n=0;n<e.news.length;n++)t.news[n].date=moment.unix(e.news[n].date).format("MM/DD/YYYY");e.news.length>0&&(t.after=e.news[e.news.length-1].id,t.scrollBusy=!1)})},t.searchSchool=function(n){e.post(t.env.api+"school/search",n).success(function(e){t.schools=e.schools})},t.detailNews=function(n){e.get(t.env.api+"news/"+n).success(function(e){t.detail=e.detail,t.detail.description=a.trustAsHtml(e.detail.description),t.detail.data=a.trustAsHtml(e.detail.data),t.detail.map_address=a.trustAsResourceUrl(e.detail.map_address),t.detail.date=moment.unix(e.detail.date).format("MM/DD/YYYY"),t.modal1.modal("show")})},t.smallModal="views/partial/login.html",t.loginForm=function(){t.smallModal="views/partial/login.html",t.modal2.modal("show")},t.registerPage=function(){t.smallModal="views/partial/register.html"},t.getAuthUser=function(){e.get(t.env.api+"auth/user").success(function(e){n.auth=e.user,t.popup()})},t.authenticate=function(e){s.authenticate(e).then(function(e){t.getAuthUser(),t.modal2.hide()})["catch"](function(e){e.error?i({message:e.error},"error"):e.data?i({message:e.data.message},e.status):i({message:e},"error")})},t.login=function(e){s.login(e).then(function(e){t.modal2.modal("hide"),t.getAuthUser()})["catch"](function(e){i({message:e.data.message},e.data.status)})},t.register=function(e){s.signup(e).then(function(e){s.setToken(e),t.getAuthUser(),t.modal2.modal("hide"),i({message:"Pendaftaran berhasil, terima kasih"},"success")})["catch"](function(e){i({message:e.data.message},e.status)})},t.isLogin=function(){return s.isAuthenticated()},t.logout=function(){s.logout(),t.loginForm()},t.isLogin()&&t.getAuthUser();var l=this;t.$watch(function(){return l.href},function(){l.rendered=!1})}];
app=angular.module("kisiNewsApp",["ui.router","ngSanitize","satellizer","ngTouch","superswipe","environment","ui-notification","ngTagsInput","ezfb","infinite-scroll"]),app.config(config).controller("newsCtrl",newsCtrl).controller("newsIndexCtrl",newsIndexCtrl).controller("newsDetailCtrl",newsDetailCtrl).directive("uiRating",function(){return function(n,i,e){$(i).rating()}}).directive("uiTab",function(){return function(n,i,e){$(i).tab()}}).directive("uiSidebar",function(){return function(n,i,e){$(i).sidebar("toggle"),$(i).sidebar("attach events",e.trigger)}}).directive("uiDropdown",function(){return function(n,i,e){$(i).dropdown({keepOnScreen:!1})}}).directive("uiAccordion",function(){return function(n,i,e){$(i).accordion()}});
